–ü–û–≠–¢–ê–ü–ù–´–ô –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –°–ò–°–¢–ï–ú–ù–û–ô –î–ï–ó–ò–ù–¢–ï–ì–†–ê–¶–ò–ò
–≠–¢–ê–ü 1: –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–ï–†–ï–î–ê–ß–ò –î–ê–ù–ù–´–•
–ü—Ä–æ–±–ª–µ–º–∞: –í  —Å—Ç—Ä–æ–∫–∞ 96 –ø–µ—Ä–µ–¥–∞–µ—Ç  –≤–º–µ—Å—Ç–æ 

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

// –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 96):
const rawResponse = await naturalLanguageGenerator.generateResponse(
  thought.memory,  // ‚ùå –û–®–ò–ë–ö–ê!
  // ...
);
// –î–û–õ–ñ–ù–û –ë–´–¢–¨:
const rawResponse = await naturalLanguageGenerator.generateResponse(
  thought.input,   // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û!
  // ...
);
–≠–¢–ê–ü 2: –£–õ–£–ß–®–ï–ù–ò–ï –ò–ó–í–õ–ï–ß–ï–ù–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–û–ì–û –í–í–û–î–ê
–ü—Ä–æ–±–ª–µ–º–∞: –í  –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

// –£–ª—É—á—à–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≤ generateResponse():
let userInput = '';
if (typeof semanticResult === 'string') {
  userInput = semanticResult;
} else if (semanticResult && typeof semanticResult === 'object') {
  // –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø–æ–ª–µ–π –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
  userInput = semanticResult.originalQuery || 
             semanticResult.userInput ||
             semanticResult.input ||
             semanticResult.query || 
             semanticResult.content ||
             '';
}
–≠–¢–ê–ü 3: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –¶–ò–ö–õ–ò–ß–ï–°–ö–û–ì–û –†–ï–§–ò–ù–ò–†–û–í–ê–ù–ò–Ø
–ü—Ä–æ–±–ª–µ–º–∞: –°–∏—Å—Ç–µ–º–∞ –∑–∞—Å—Ç—Ä–µ–≤–∞–µ—Ç –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ü–∏–∫–ª–µ —Å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –æ—Ü–µ–Ω–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–∞

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

// –í conversation-engine.cjs –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É —Ü–∏–∫–ª–∞:
while (responseQuality < 7 && iterationCount < 3) {
  // –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ
  const previousQuality = responseQuality;
  
  // ... —Ä–µ—Ñ–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ...
  
  const newQuality = semanticQualityScore(rawResponse.response, thought.meta);
  
  // –ï—Å–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –Ω–µ —É–ª—É—á—à–∞–µ—Ç—Å—è, –ø—Ä–µ—Ä—ã–≤–∞–µ–º —Ü–∏–∫–ª
  if (newQuality <= previousQuality + 0.1) {
    break;
  }
  
  responseQuality = newQuality;
  iterationCount++;
}
–≠–¢–ê–ü 4: –£–°–¢–†–ê–ù–ï–ù–ò–ï API –î–ï–ó–ò–ù–¢–ï–ì–†–ê–¶–ò–ò
–ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ç–æ–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—É—á–∞—é—Ç HTML –≤–º–µ—Å—Ç–æ JSON

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏:

// –í routes.ts —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ /api/stream –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏:
res.setHeader('Content-Type', 'text/event-stream');
res.setHeader('Cache-Control', 'no-cache');
res.setHeader('Connection', 'keep-alive');
// –ò –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ conversation-engine
–≠–¢–ê–ü 5: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –°–ï–ú–ê–ù–¢–ò–ß–ï–°–ö–ò–• –ú–û–î–£–õ–ï–ô
–ü—Ä–æ–±–ª–µ–º–∞: –ú–æ–¥—É–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

// –í conversation-engine.cjs —É–ª—É—á—à–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏:
const thought = {
  input,                    // ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å
  originalInput: input,     // ‚úÖ –î—É–±–ª–∏—Ä—É–µ–º –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
  meta: meta.semanticResult || meta,
  emotion,
  memory,
  persona,
  context: userContext
};
–≠–¢–ê–ü 6: –£–õ–£–ß–®–ï–ù–ò–ï FALLBACK –õ–û–ì–ò–ö–ò
–ü—Ä–æ–±–ª–µ–º–∞: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã –≤–º–µ—Å—Ç–æ –∂–∏–≤–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

// –í natural-language-generator.cjs —É–ª—É—á—à–∏—Ç—å fallback:
if (!userInput || userInput.trim() === '') {
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
  if (context.conversationHistory && context.conversationHistory.length > 0) {
    return "–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞—à —Ä–∞–∑–≥–æ–≤–æ—Ä! –û —á–µ–º —Ö–æ—Ç–∏—Ç–µ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å –¥–∞–ª—å—à–µ?";
  }
  
  return "–ü—Ä–∏–≤–µ—Ç! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å? üòä";
}